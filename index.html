<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Globber’s Ink Log</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="page">
    <div class="topbar">
      <div class="brandRow">
        <div class="brandLeft">
          <div class="logoWrap" title="Tap to upload logo" id="logoWrap">
            <img id="logoImg" class="logoImg" alt="Logo">
            <input id="logoInput" type="file" accept="image/png,image/*" style="display:none;">
          </div>
          <div class="brandText">
            <div class="brandTitle">Globber’s Ink Log</div>
            <div class="brandActions">
              <div id="splitPill" class="topBtn" title="Tap to edit split" onclick="openSettings()">
                Split: <b id="splitPillPct">100%</b> (NET)
              </div>
              <button class="topBtn" type="button" onclick="openBills()">Bills</button>
              <button class="topBtn" type="button" onclick="openExport()">Export</button>
              <button class="topBtn secondarybtn" type="button" onclick="openRewards()">Rewards</button>
            </div>
          </div>
        </div>
      </div>

      <div class="stats">
        <div class="stat"><div class="statNum" id="todayTotal">$0</div><div class="statLbl">Today (NET)</div></div>
        <div class="stat"><div class="statNum" id="weekTotal">$0</div><div class="statLbl">Week (NET)</div></div>
        <div class="stat"><div class="statNum" id="monthTotal">$0</div><div class="statLbl">Month (NET)</div></div>
        <div class="stat"><div class="statNum" id="quarterTotal">$0</div><div class="statLbl">Quarter (NET)</div></div>
        <div class="stat"><div class="statNum" id="yearTotal">$0</div><div class="statLbl">Year (NET)</div></div>
      </div>
    </div>

    <div class="filters">
      <div class="filtersHeader" id="filtersHeader">
        <div style="display:flex;align-items:baseline;gap:10px;flex-wrap:wrap;">
          <div class="filtersTitle">Filters</div>
          <div class="filtersSummary" id="filtersSummary">All entries</div>
        </div>
        <div class="filtersChev" id="filtersChev">▾</div>
      </div>

      <div class="filtersContent" id="filtersContent">
        <div class="row">
          <input id="q" type="text" placeholder="Search (client, description, location)">
          <select id="statusFilter">
            <option value="all">All Status</option>
            <option value="booked">Booked</option>
            <option value="paid">Paid</option>
            <option value="partial">Partial</option>
            <option value="unpaid">Unpaid</option>
            <option value="no_show">No Show</option>
          </select>
          <select id="locationFilter">
            <option value="all">All Locations</option>
          </select>
        </div>

        <div class="row">
          <input id="fromDate" type="date">
          <input id="toDate" type="date">
          <select id="sortFilter">
            <option value="newest">Sort: Newest</option>
            <option value="oldest">Sort: Oldest</option>
          </select>
        </div>

        <div class="actionsRow">
          <button type="button" class="secondarybtn" onclick="clearFilters()">Clear</button>
          <button type="button" onclick="applyFilters()">Apply</button>
        </div>
      </div>
    </div>

    <div class="entries" id="entries"></div>
  </div>

  <div class="fabStack" aria-label="Quick actions">
    <button class="fab small" type="button" title="Quick Add: Deposit Only" onclick="openDepositQuick()"><span class="fabIcon">DEP</span></button>
    <button class="fab small" type="button" title="Quick Add: Bammer" onclick="openBammerQuick()"><span class="fabIcon">BAM</span></button>
    <button class="fab main" type="button" title="Add Entry" onclick="openForm()">+</button>
  </div>

  <!-- ADD/EDIT ENTRY MODAL -->
  <div class="modal" id="formModal">
    <div class="modalBox" id="formBox">
      <div class="modal-title" id="formTitle">Add Entry</div>

      <input type="date" id="date">
      <input type="text" id="client" placeholder="Client Name">

      <div class="row">
        <input type="text" id="contact" placeholder="Client Contact">
        <input type="text" id="social" placeholder="Client Social">
      </div>

      <textarea id="description" placeholder="Tattoo Description"></textarea>

      <select id="location">
        <option value="">Location</option>
        <option>Arm</option><option>Leg</option><option>Back</option><option>Chest</option>
        <option>Hand</option><option>Foot</option><option>Neck</option>
      </select>

      <div class="row">
        <input type="number" id="total" placeholder="Total Price">
        <input type="number" id="deposit" placeholder="Deposit (optional)">
      </div>

      <select id="status">
        <option value="booked">Booked</option>
        <option value="unpaid">Unpaid</option>
        <option value="partial">Partial</option>
        <option value="paid">Paid</option>
        <option value="no_show">No Show</option>
      </select>

      <div id="sessions"></div>
      <button type="button" onclick="addSession()">+ Additional Session</button>

      <textarea id="notes" placeholder="Notes"></textarea>
      <input type="file" id="image" accept="image/*">

      <div class="actionsRow">
        <button type="button" onclick="saveEntry()">Save</button>
        <button type="button" class="secondarybtn" onclick="closeForm()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- QUICK ADD: BAMMER -->
  <div class="modal" id="bammerModal">
    <div class="modalBox" id="bammerBox">
      <div class="modal-title">Quick Add — Bammer</div>

      <input type="date" id="bDate">
      <input type="text" id="bClient" placeholder="Client Name">
      <textarea id="bDesc" placeholder="Tattoo Description (quick)"></textarea>

      <div class="row">
        <select id="bLocation">
          <option value="">Location</option>
          <option>Arm</option><option>Leg</option><option>Back</option><option>Chest</option>
          <option>Hand</option><option>Foot</option><option>Neck</option>
        </select>
        <input type="number" id="bTotal" placeholder="Total Price">
      </div>

      <select id="bStatus">
        <option value="paid">Paid</option>
        <option value="partial">Partial</option>
        <option value="unpaid">Unpaid</option>
        <option value="booked">Booked</option>
        <option value="no_show">No Show</option>
      </select>

      <div class="actionsRow">
        <button type="button" onclick="saveBammer()">Save Bammer</button>
        <button type="button" class="secondarybtn" onclick="closeBammerQuick()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- QUICK ADD: DEPOSIT ONLY -->
  <div class="modal" id="depositModal">
    <div class="modalBox" id="depositBox">
      <div class="modal-title">Quick Add — Deposit Only</div>

      <input type="date" id="dDate">
      <input type="text" id="dClient" placeholder="Client Name">

      <div class="row">
        <input type="text" id="dContact" placeholder="Client Contact (optional)">
        <input type="text" id="dSocial" placeholder="Client Social (optional)">
      </div>

      <textarea id="dDesc" placeholder="What’s the deposit for? (optional)"></textarea>

      <div class="row">
        <input type="number" id="dDeposit" placeholder="Deposit Amount">
        <input type="number" id="dTotal" placeholder="Total Price (optional)">
      </div>

      <select id="dLocation">
        <option value="">Location</option>
        <option>Arm</option><option>Leg</option><option>Back</option><option>Chest</option>
        <option>Hand</option><option>Foot</option><option>Neck</option>
      </select>

      <div class="actionsRow">
        <button type="button" onclick="saveDepositOnly()">Save Deposit</button>
        <button type="button" class="secondarybtn" onclick="closeDepositQuick()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- VIEW ENTRY MODAL -->
  <div class="modal" id="viewModal">
    <div class="modalBox" id="viewBox"></div>
  </div>

  <!-- CLIENT PROFILE MODAL -->
  <div class="modal" id="clientModal">
    <div class="modalBox" id="clientBox"></div>
  </div>

  <!-- SETTINGS MODAL -->
  <div class="modal" id="settingsModal">
    <div class="modalBox" id="settingsBox">
      <div class="modal-title">Settings</div>

      <div class="summary-box" style="margin-top:0;">
        <div style="font-weight:900;color:var(--gold);">Payout Split</div>
        <div class="hint">Used for NET totals unless a month override exists.</div>
        <input id="defaultSplitPct" type="number" min="0" max="100" step="1" placeholder="e.g. 60">
      </div>

      <div class="summary-box">
        <div style="font-weight:900;color:var(--gold);">Monthly override</div>
        <div class="hint">Set a different % for a specific month.</div>
        <div class="row">
          <input id="overrideMonth" type="month">
          <input id="overridePct" type="number" min="0" max="100" step="1" placeholder="e.g. 65">
        </div>
        <div class="actionsRow">
          <button type="button" onclick="saveMonthOverride()">Save Override</button>
          <button type="button" class="secondarybtn" onclick="removeMonthOverride()">Remove Override</button>
        </div>
        <div id="overrideList" class="hint" style="margin-top:10px;"></div>
      </div>

      <div class="summary-box">
        <div style="font-weight:900;color:var(--gold);">Client Rewards</div>
        <div class="hint">Badges + discounts auto-update when you log tattoos.</div>
        <div class="actionsRow">
          <button type="button" onclick="openRewards()">Open Rewards Setup</button>
        </div>
      </div>

      <div class="summary-box">
        <div style="font-weight:900;color:var(--gold);">Backup / Restore</div>
        <div class="hint">Download a backup so you never lose your data.</div>
        <div class="actionsRow">
          <button type="button" onclick="downloadBackup()">Download Backup (JSON)</button>
        </div>
        <hr>
        <div class="hint">Restore from a backup JSON file.</div>
        <input id="restoreFile" type="file" accept="application/json">
        <div class="actionsRow">
          <button type="button" class="dangerbtn" onclick="restoreBackup()">Restore Backup</button>
        </div>
      </div>

      <div class="actionsRow">
        <button type="button" onclick="saveSplitSettings()">Save Settings</button>
        <button type="button" class="secondarybtn" onclick="closeSettings()">Close</button>
      </div>
    </div>
  </div>

  <!-- REWARDS MODAL -->
  <div class="modal" id="rewardsModal">
    <div class="modalBox" id="rewardsBox">
      <div class="modal-title">Client Rewards Setup</div>

      <details open>
        <summary>Badge Levels</summary>
        <div class="hint" style="margin-top:8px;">
          Levels are based on <b>tattoo count</b> (non-deposit-only entries). Highest matching tier wins.
        </div>
        <div id="levelsList" style="margin-top:10px;"></div>
        <div class="actionsRow">
          <button type="button" onclick="addBadgeLevel()">+ Add Badge Level</button>
        </div>
      </details>

      <hr>

      <details open>
        <summary>Discount Tiers</summary>
        <div class="hint" style="margin-top:8px;">
          Discounts are also based on tattoo count. Highest matching tier wins.
        </div>
        <div id="discountsList" style="margin-top:10px;"></div>
        <div class="actionsRow">
          <button type="button" onclick="addDiscountTier()">+ Add Discount Tier</button>
        </div>
      </details>

      <div class="actionsRow">
        <button type="button" onclick="saveRewards()">Save Rewards</button>
        <button type="button" class="secondarybtn" onclick="closeRewards()">Close</button>
      </div>
    </div>
  </div>

  <!-- EXPORT MODAL -->
  <div class="modal" id="exportModal">
    <div class="modalBox" id="exportBox">
      <div class="modal-title">Export</div>

      <div class="summary-box" style="margin-top:0;">
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;">
          <div style="font-weight:900;color:var(--gold);">Logo</div>
          <div class="actionsRow" style="margin-top:0;">
            <button type="button" class="secondarybtn" onclick="removeLogo()">Remove Logo</button>
          </div>
        </div>
        <div class="hint">Tap the logo in the header to upload a PNG.</div>
      </div>

      <hr>

      <label class="hint">Payday (week starts on this day)</label>
      <select id="paydaySelect">
        <option value="0">Sunday</option><option value="1">Monday</option><option value="2">Tuesday</option>
        <option value="3">Wednesday</option><option value="4">Thursday</option><option value="5">Friday</option>
        <option value="6">Saturday</option>
      </select>

      <hr>

      <h4 style="margin:0;">Pay Period (Payday Week)</h4>
      <div class="row">
        <input type="date" id="ppStart" disabled>
        <input type="date" id="ppEnd" disabled>
      </div>
      <div class="actionsRow">
        <button type="button" class="secondarybtn" onclick="prevPayPeriod()">◀ Prev</button>
        <button type="button" class="secondarybtn" onclick="nextPayPeriod()">Next ▶</button>
        <button type="button" onclick="exportPayPeriodCSV()">Export This Pay Period</button>
      </div>

      <hr>

      <h4 style="margin:0;">CSV Date Range</h4>
      <div class="row">
        <input type="date" id="exportStart">
        <input type="date" id="exportEnd">
      </div>

      <div class="actionsRow">
        <button type="button" onclick="exportCSV()">Download CSV</button>
        <button type="button" class="secondarybtn" onclick="closeExport()">Close</button>
      </div>

      <div class="summary-box">
        <h4 style="margin:0 0 8px 0;">Export Summary</h4>
        <div class="actionsRow">
          <button type="button" onclick="buildSummary('range')">Summary for Date Range</button>
          <button type="button" class="secondarybtn" onclick="buildSummary('payperiod')">Summary for Pay Period</button>
        </div>
        <div id="summaryOut" style="margin-top:10px; opacity:.95;"></div>
      </div>
    </div>
  </div>

  <!-- BILLS MODAL -->
  <div class="modal" id="billsModal">
    <div class="modalBox" id="billsBox">
      <div class="modal-title">Bills & Rent</div>

      <div class="summary-box" style="margin-top:0;">
        <div style="font-weight:900;color:var(--gold);">Rent</div>
        <div class="hint">Due on the <b>1st</b>. Every month. No exceptions.</div>
        <div class="row">
          <input id="rentAmount" type="number" min="0" step="0.01" placeholder="Rent amount (e.g. 1450)">
          <input id="rentSavedSoFar" type="number" min="0" step="0.01" placeholder="Saved so far (optional)">
        </div>
      </div>

      <div class="summary-box">
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;">
          <div style="font-weight:900;color:var(--gold);">Bills</div>
          <div class="actionsRow" style="margin-top:0;">
            <button type="button" onclick="InkBills.addBill()">+ Add Bill</button>
          </div>
        </div>
        <div id="billsList" style="margin-top:10px;"></div>
      </div>

      <div class="summary-box">
        <div style="font-weight:900;color:var(--gold);">Today’s target</div>
        <div id="billsTodayOut" style="margin-top:8px;"></div>
        <div id="billsQuote" style="margin-top:12px; font-weight:900; color:var(--gold); opacity:.92;"></div>
      </div>

      <div class="actionsRow">
        <button type="button" onclick="InkBills.saveBills()">Save</button>
        <button type="button" class="secondarybtn" onclick="InkBills.closeBills()">Close</button>
      </div>
    </div>
  </div>

  <div class="toasts" id="toasts"></div>

  <script src="app.js"></script>
  <script src="bills.js"></script>
</body>
</html>