<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Globber’s Ink Log</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --panel:#1a241f;
      --panel2:#16201b;
      --emerald:#1f6f50;
      --gold:#d4af37;
      --text:#f2f2f2;
      --danger:#a94442;
      --muted:rgba(255,255,255,.75);
      --booked:#2a5bd7;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      color:var(--text);
      background:linear-gradient(160deg,#0e1512,#081a14);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    header{
      padding:16px 18px;
      border-bottom:2px solid var(--gold);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .brand-title{
      font-family:Cinzel, serif;
      font-weight:800;
      letter-spacing:.03em;
      font-size:1.35rem;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    #logoImg{
      width:40px;height:40px;
      border-radius:12px;
      border:1px solid rgba(212,175,55,.35);
      object-fit:cover;
      background:var(--panel2);
      cursor:pointer;
      flex:0 0 auto;
    }
    #logoInput{ display:none; }

    .header-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .smallbtn{
      background:var(--panel2);
      border:1px solid rgba(212,175,55,.35);
      color:var(--text);
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
      white-space:nowrap;
    }
    .smallbtn:hover{ filter:brightness(1.06); }

    #stats{
      display:flex;
      justify-content:space-around;
      padding:12px 10px;
      border-bottom:1px solid var(--emerald);
      gap:10px;
      flex-wrap:wrap;
    }
    #stats strong{ color:var(--gold); font-size:1.05rem; }

    .container{ padding:16px 18px 90px; }

    /* FILTER DROPDOWN */
    .filters-shell{
      background:var(--panel);
      border:2px solid rgba(31,111,80,.8);
      border-radius:12px;
      margin-bottom:14px;
      overflow:hidden;
    }
    .filters-toggle{
      background:var(--panel2);
      padding:12px 14px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      user-select:none;
      gap:10px;
    }
    .filters-toggle:hover{ filter:brightness(1.05); }
    .filters-title{
      font-weight:900;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .filters-sub{
      font-size:.85rem;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:52vw;
    }
    .filters-content{
      display:none;
      padding:12px;
    }

    .filterbar .row{
      display:grid;
      grid-template-columns: 1.2fr 0.8fr 0.8fr;
      gap:10px;
    }
    @media(max-width:820px){ .filterbar .row{ grid-template-columns:1fr; } }

    .filterbar input, .filterbar select{
      display:block;
      margin:0;
      padding:10px;
      width:100%;
      background:#121b17;
      color:white;
      border:1px solid var(--emerald);
      border-radius:10px;
    }
    .filterbar .row2{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media(max-width:820px){ .filterbar .row2{ grid-template-columns:1fr; } }

    .filter-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
      align-items:center;
      justify-content:space-between;
    }
    .hint{ font-size:.9rem; opacity:.85; color:var(--muted); }

    .accordion{
      background:var(--panel);
      border:2px solid var(--emerald);
      border-radius:12px;
      margin-bottom:12px;
      overflow:hidden;
    }
    .accordion-header{
      padding:12px 14px;
      cursor:pointer;
      background:var(--panel2);
      display:flex;
      justify-content:space-between;
      align-items:center;
      user-select:none;
      gap:10px;
    }
    .accordion-header:hover{ filter:brightness(1.05); }
    .accordion-title{ font-weight:800; }
    .badge{
      font-size:.85rem;
      color:#111;
      background:var(--gold);
      border-radius:999px;
      padding:2px 10px;
      margin-left:10px;
      white-space:nowrap;
    }
    .chev{ opacity:.85; margin-left:10px; }
    .accordion-content{ display:none; padding:10px 12px 12px; }

    .entry{
      background:#223029;
      padding:10px 12px;
      margin:8px 0;
      border-left:4px solid var(--gold);
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      cursor:pointer;
      border-radius:10px;
    }
    .entry:hover{ outline:1px solid rgba(212,175,55,.35); }

    .entry-left{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width:0;
      flex:1 1 auto;
    }
    .entry-name{
      font-weight:900;
      color:var(--gold);
      line-height:1.1;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .client-link{
      color:var(--gold);
      text-decoration:underline;
      cursor:pointer;
      font-weight:900;
    }
    .client-badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(212,175,55,.35);
      background:rgba(0,0,0,.18);
      font-size:.78rem;
      color:rgba(255,255,255,.88);
      white-space:nowrap;
      max-width:220px;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .client-badge img{
      width:16px;height:16px;
      border-radius:4px;
      object-fit:cover;
      border:1px solid rgba(212,175,55,.25);
      background:var(--panel2);
      flex:0 0 auto;
    }

    .entry-sub{
      display:flex;
      flex-direction:column;
      gap:2px;
      font-size:.92rem;
      opacity:.92;
      min-width:0;
    }
    .sub-row{ line-height:1.25; word-break:break-word; }
    .sub-row.clamp2{
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    .status{
      padding:3px 8px;
      border-radius:8px;
      font-size:.8rem;
      text-transform:uppercase;
      letter-spacing:.04em;
      margin-top:2px;
      white-space:nowrap;
      flex:0 0 auto;
    }
    .paid{background:#2e7d32;}
    .partial{background:#f9a825; color:#111;}
    .unpaid{background:#616161;}
    .no_show{background:var(--danger);}
    .booked{background:var(--booked);}

    /* Floating icon fabs */
    .fab-wrap{
      position:fixed;
      right:18px;
      bottom:18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:5000;
    }
    .fab{
      width:64px;height:64px;
      border-radius:50%;
      background:var(--emerald);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 0 25px rgba(212,175,55,.4);
      cursor:pointer;
      border:none;
    }
    .fab.small{
      width:54px;height:54px;
      background:#245a46;
      border:1px solid rgba(212,175,55,.25);
      box-shadow:0 0 18px rgba(212,175,55,.25);
    }
    .fab svg{ width:26px; height:26px; fill:white; }
    .fab.small svg{ width:22px; height:22px; }
    .fab:hover{ filter:brightness(1.06); }

    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.9);
      display:none;
      align-items:flex-start;
      justify-content:center;
      padding:
        calc(96px + env(safe-area-inset-top))
        calc(18px + env(safe-area-inset-right))
        calc(50px + env(safe-area-inset-bottom))
        calc(18px + env(safe-area-inset-left));
      overflow:auto;
      z-index:9999;
    }
    .modal-box{
      background:var(--panel);
      padding:35px 20px 25px;
      border:2px solid var(--gold);
      border-radius:14px;
      max-width:680px;
      width:100%;
      margin:0 auto;
      box-shadow:0 20px 50px rgba(0,0,0,.6);
    }
    .modal-title{
      font-family:Cinzel, serif;
      font-size:1.25rem;
      font-weight:800;
      color:var(--gold);
      margin:0 0 14px 0;
      border-bottom:1px solid rgba(212,175,55,.3);
      padding-bottom:10px;
    }

    input, textarea, select{
      display:block;
      margin:8px auto;
      padding:10px;
      width:100%;
      background:#121b17;
      color:white;
      border:1px solid var(--emerald);
      border-radius:10px;
    }
    textarea{ min-height:90px; }

    button{
      background:var(--emerald);
      color:white;
      border:none;
      padding:10px 12px;
      margin-top:10px;
      cursor:pointer;
      border-radius:10px;
    }
    button:hover{ filter:brightness(1.06); }

    .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media(max-width:640px){ .row{grid-template-columns:1fr;} }

    .actions-row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .dangerbtn{ background:var(--danger); }
    .secondarybtn{ background:var(--panel2); border:1px solid rgba(31,111,80,.65); }

    hr{ border:none; border-top:1px solid rgba(31,111,80,.6); margin:14px 0; }

    details{ background:var(--panel2); border:1px solid rgba(212,175,55,.25); padding:10px; border-radius:12px; }
    details summary{ cursor:pointer; font-weight:800; color:var(--gold); }

    .summary-box{
      margin-top:10px;
      background:var(--panel2);
      border:1px solid rgba(212,175,55,.25);
      padding:12px;
      border-radius:12px;
    }
    .summary-grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media(max-width:640px){ .summary-grid{grid-template-columns:1fr;} }

    .client-entry{
      background:#223029;
      border-left:4px solid rgba(212,175,55,.7);
      padding:10px 12px;
      border-radius:10px;
      cursor:pointer;
      margin-top:8px;
    }
    .client-entry:hover{ outline:1px solid rgba(212,175,55,.35); }
    .client-entry .top{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }
    .client-entry .date{ color:var(--muted); font-size:.9rem; white-space:nowrap; }
    .client-entry .desc{
      opacity:.92;
      margin-top:6px;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    /* Appointments list cards */
    .appt-card{
      background:#223029;
      border-left:4px solid var(--booked);
      padding:12px 12px;
      border-radius:12px;
      cursor:pointer;
      margin-top:10px;
    }
    .appt-card:hover{ outline:1px solid rgba(42,91,215,.5); }
    .appt-top{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .appt-name{
      font-weight:900;
      color:var(--gold);
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      min-width:0;
    }
    .appt-date{ color:var(--muted); white-space:nowrap; font-size:.92rem; }
    .appt-sub{ margin-top:6px; opacity:.92; display:flex; flex-direction:column; gap:4px; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 10px;
      border-radius:999px;
      border:1px solid rgba(212,175,55,.25);
      background:rgba(0,0,0,.16);
      font-size:.82rem;
      color:rgba(255,255,255,.9);
      width:max-content;
    }
    .pill.blue{ border-color: rgba(42,91,215,.6); }
    .pill.gold{ border-color: rgba(212,175,55,.35); }
  </style>
</head>

<body>
  <header>
    <div class="brand">
      <img id="logoImg" alt="Logo" title="Tap to upload logo">
      <input id="logoInput" type="file" accept="image/png,image/*">
      <div class="brand-title">Globber’s Ink Log</div>
    </div>

    <div class="header-actions">
      <button class="smallbtn" type="button" onclick="openAppointments()">Appointments</button>
      <button class="smallbtn" type="button" onclick="openStudio()">Studio</button>
      <button class="smallbtn" type="button" onclick="openExport()">Export</button>
    </div>
  </header>

  <div id="stats">
    <div><strong id="todayTotal">$0</strong><br><small>Today</small></div>
    <div><strong id="weekTotal">$0</strong><br><small>Week</small></div>
    <div><strong id="monthTotal">$0</strong><br><small>Month</small></div>
    <div><strong id="quarterTotal">$0</strong><br><small>Quarter</small></div>
    <div><strong id="yearTotal">$0</strong><br><small>Year</small></div>
  </div>

  <div class="container">

    <!-- TOGGLE FILTERS -->
    <div class="filters-shell">
      <div class="filters-toggle" onclick="toggleFilters()">
        <div class="filters-title">
          Filters
          <span class="filters-sub" id="filtersSummary"></span>
        </div>
        <div style="opacity:.85;" id="filtersChev">▾</div>
      </div>

      <div class="filters-content" id="filtersContent">
        <div class="filterbar">
          <div class="row">
            <input id="q" type="text" placeholder="Search (client, description, location)">

            <select id="statusFilter">
              <option value="all">All Status</option>
              <option value="booked">Booked</option>
              <option value="paid">Paid</option>
              <option value="partial">Partial</option>
              <option value="unpaid">Unpaid</option>
              <option value="no_show">No Show</option>
            </select>

            <select id="locationFilter">
              <option value="all">All Locations</option>
            </select>
          </div>

          <div class="row2">
            <input id="fromDate" type="date">
            <input id="toDate" type="date">
            <select id="sortFilter">
              <option value="newest">Sort: Newest</option>
              <option value="oldest">Sort: Oldest</option>
            </select>
          </div>

          <div class="filter-actions">
            <div class="hint">Filters affect the accordion + totals shown.</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
              <button type="button" class="secondarybtn" onclick="clearFilters()">Clear</button>
              <button type="button" onclick="applyFilters()">Apply</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="entries"></div>
  </div>

  <!-- ICON FABs -->
  <div class="fab-wrap">
    <button class="fab small" title="Quick Add: Deposit Only" onclick="openDepositQuick()">
      <!-- $ + down arrow -->
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 2c.55 0 1 .45 1 1v1.08c1.86.23 3.25 1.33 3.25 3.02 0 .55-.45 1-1 1s-1-.45-1-1c0-.77-.83-1.33-2.25-1.33H10.7c-1.35 0-2.2.55-2.2 1.33 0 .72.78 1.1 2.45 1.46l1.35.29c2.42.52 3.95 1.54 3.95 3.56 0 1.9-1.45 3.09-3.25 3.33V19c0 .55-.45 1-1 1s-1-.45-1-1v-1.08c-2.04-.25-3.55-1.5-3.55-3.25 0-.55.45-1 1-1s1 .45 1 1c0 .92.98 1.58 2.55 1.58h1.25c1.5 0 2.35-.62 2.35-1.48 0-.86-.92-1.25-2.7-1.63l-1.22-.26C9.3 11.87 7.5 10.98 7.5 8.9c0-1.72 1.35-2.8 3.5-3.02V3c0-.55.45-1 1-1z"/>
        <path d="M12 21a1 1 0 0 1-1-1v-4.59l-1.3 1.3a1 1 0 1 1-1.4-1.42l3-3a1 1 0 0 1 1.4 0l3 3a1 1 0 1 1-1.4 1.42L13 15.41V20a1 1 0 0 1-1 1z"/>
      </svg>
    </button>

    <button class="fab small" title="Quick Add: Bammer" onclick="openBammerQuick()">
      <!-- explosion-ish -->
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M13.2 2.5l1.1 4.2 3.7-2.2-2.1 3.8 4.1 1-4.1 1 2.1 3.8-3.7-2.2-1.1 4.2-1.1-4.2-3.7 2.2 2.1-3.8-4.1-1 4.1-1-2.1-3.8 3.7 2.2 1.1-4.2z"/>
        <path d="M12 13c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4z" opacity=".85"/>
      </svg>
    </button>

    <button class="fab" title="Add Entry" onclick="openForm()">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M11 5a1 1 0 0 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6V5z"/>
      </svg>
    </button>
  </div>

  <!-- ADD/EDIT ENTRY MODAL -->
  <div class="modal" id="formModal">
    <div class="modal-box" id="formBox">
      <div class="modal-title" id="formTitle">Add Entry</div>

      <input type="date" id="date">
      <input type="text" id="client" placeholder="Client Name">

      <div class="row">
        <input type="text" id="contact" placeholder="Client Contact">
        <input type="text" id="social" placeholder="Client Social">
      </div>

      <textarea id="description" placeholder="Tattoo Description"></textarea>

      <select id="location">
        <option value="">Location</option>
        <option>Arm</option><option>Leg</option><option>Back</option><option>Chest</option>
        <option>Hand</option><option>Foot</option><option>Neck</option>
      </select>

      <div class="row">
        <input type="number" id="total" placeholder="Total Price">
        <input type="number" id="deposit" placeholder="Deposit (optional)">
      </div>

      <select id="status">
        <option value="booked">Booked</option>
        <option value="unpaid">Unpaid</option>
        <option value="partial">Partial</option>
        <option value="paid">Paid</option>
        <option value="no_show">No Show</option>
      </select>

      <div id="sessions"></div>
      <button type="button" onclick="addSession()">+ Additional Session</button>

      <textarea id="notes" placeholder="Notes"></textarea>
      <input type="file" id="image" accept="image/*">

      <div class="actions-row">
        <button type="button" onclick="saveEntry()">Save</button>
        <button type="button" class="secondarybtn" onclick="closeForm()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- QUICK ADD: BAMMER -->
  <div class="modal" id="bammerModal">
    <div class="modal-box" id="bammerBox">
      <div class="modal-title">Quick Add — Bammer</div>

      <input type="date" id="bDate">
      <input type="text" id="bClient" placeholder="Client Name">
      <textarea id="bDesc" placeholder="Tattoo Description (quick)"></textarea>

      <div class="row">
        <select id="bLocation">
          <option value="">Location</option>
          <option>Arm</option><option>Leg</option><option>Back</option><option>Chest</option>
          <option>Hand</option><option>Foot</option><option>Neck</option>
        </select>
        <input type="number" id="bTotal" placeholder="Total Price">
      </div>

      <select id="bStatus">
        <option value="paid">Paid</option>
        <option value="partial">Partial</option>
        <option value="unpaid">Unpaid</option>
        <option value="booked">Booked</option>
        <option value="no_show">No Show</option>
      </select>

      <div class="actions-row">
        <button type="button" onclick="saveBammer()">Save Bammer</button>
        <button type="button" class="secondarybtn" onclick="closeBammerQuick()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- QUICK ADD: DEPOSIT ONLY -->
  <div class="modal" id="depositModal">
    <div class="modal-box" id="depositBox">
      <div class="modal-title">Quick Add — Deposit Only</div>

      <input type="date" id="dDate">
      <input type="text" id="dClient" placeholder="Client Name">

      <div class="row">
        <input type="text" id="dContact" placeholder="Client Contact (optional)">
        <input type="text" id="dSocial" placeholder="Client Social (optional)">
      </div>

      <textarea id="dDesc" placeholder="What’s the deposit for? (optional)"></textarea>

      <div class="row">
        <input type="number" id="dDeposit" placeholder="Deposit Amount">
        <input type="number" id="dTotal" placeholder="Total Price (optional)">
      </div>

      <select id="dLocation">
        <option value="">Location</option>
        <option>Arm</option><option>Leg</option><option>Back</option><option>Chest</option>
        <option>Hand</option><option>Foot</option><option>Neck</option>
      </select>

      <div class="actions-row">
        <button type="button" onclick="saveDepositOnly()">Save Deposit</button>
        <button type="button" class="secondarybtn" onclick="closeDepositQuick()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- VIEW ENTRY MODAL -->
  <div class="modal" id="viewModal">
    <div class="modal-box" id="viewBox"></div>
  </div>

  <!-- CLIENT PROFILE MODAL -->
  <div class="modal" id="clientModal">
    <div class="modal-box" id="clientBox"></div>
  </div>

  <!-- STUDIO MODAL (Split + Rewards together) -->
  <div class="modal" id="studioModal">
    <div class="modal-box" id="studioBox">
      <div class="modal-title">Studio</div>

      <div class="summary-box" style="margin-top:0;">
        <div style="font-weight:900;color:var(--gold);">Payout Split</div>
        <div class="hint">Totals use this unless a month override exists.</div>
        <input id="defaultSplitPct" type="number" min="0" max="100" step="1" placeholder="e.g. 60">
      </div>

      <div class="summary-box">
        <div style="font-weight:900;color:var(--gold);">Monthly override</div>
        <div class="hint">Set a different % for a specific month.</div>
        <div class="row">
          <input id="overrideMonth" type="month">
          <input id="overridePct" type="number" min="0" max="100" step="1" placeholder="e.g. 65">
        </div>
        <div class="actions-row">
          <button type="button" onclick="saveMonthOverride()">Save Override</button>
          <button type="button" class="secondarybtn" onclick="removeMonthOverride()">Remove Override</button>
        </div>
        <div id="overrideList" class="hint" style="margin-top:10px;"></div>
      </div>

      <div class="summary-box">
        <div style="font-weight:900;color:var(--gold);">Rewards & Discounts</div>
        <div class="hint">Badges + discounts auto-update when you log tattoos.</div>
        <div class="actions-row">
          <button type="button" onclick="openRewards()">Open Rewards Setup</button>
        </div>
      </div>

      <div class="summary-box">
        <div style="font-weight:900;color:var(--gold);">Backup / Restore</div>
        <div class="hint">Download a backup so you never lose your data.</div>
        <div class="actions-row">
          <button type="button" onclick="downloadBackup()">Download Backup (JSON)</button>
        </div>
        <hr>
        <div class="hint">Restore from a backup JSON file.</div>
        <input id="restoreFile" type="file" accept="application/json">
        <div class="actions-row">
          <button type="button" class="dangerbtn" onclick="restoreBackup()">Restore Backup</button>
        </div>
      </div>

      <div class="actions-row">
        <button type="button" onclick="saveSplitSettings()">Save Studio</button>
        <button type="button" class="secondarybtn" onclick="closeStudio()">Close</button>
      </div>
    </div>
  </div>

  <!-- REWARDS MODAL -->
  <div class="modal" id="rewardsModal">
    <div class="modal-box" id="rewardsBox">
      <div class="modal-title">Client Rewards Setup</div>

      <details open>
        <summary>Badge Levels</summary>
        <div class="hint" style="margin-top:8px;">
          Levels are based on <b>tattoo count</b> (non-deposit-only entries). Highest matching tier wins.
        </div>
        <div id="levelsList" style="margin-top:10px;"></div>
        <div class="actions-row">
          <button type="button" onclick="addBadgeLevel()">+ Add Badge Level</button>
        </div>
      </details>

      <hr>

      <details open>
        <summary>Discount Tiers</summary>
        <div class="hint" style="margin-top:8px;">
          Discounts are also based on tattoo count. Highest matching tier wins.
        </div>
        <div id="discountsList" style="margin-top:10px;"></div>
        <div class="actions-row">
          <button type="button" onclick="addDiscountTier()">+ Add Discount Tier</button>
        </div>
      </details>

      <div class="actions-row">
        <button type="button" onclick="saveRewards()">Save Rewards</button>
        <button type="button" class="secondarybtn" onclick="closeRewards()">Close</button>
      </div>
    </div>
  </div>

  <!-- APPOINTMENTS MODAL -->
  <div class="modal" id="appointmentsModal">
    <div class="modal-box" id="appointmentsBox">
      <div class="modal-title">Appointments (BOOKED)</div>

      <div class="summary-box" style="margin-top:0;">
        <div class="row">
          <input id="apptQ" type="text" placeholder="Search booked (client / desc / location)">
          <select id="apptMode">
            <option value="upcoming">Upcoming only</option>
            <option value="all">All booked</option>
          </select>
        </div>
        <div class="hint">Tap any appointment to open it.</div>
      </div>

      <div id="appointmentsList"></div>

      <div class="actions-row">
        <button type="button" class="secondarybtn" onclick="closeAppointments()">Close</button>
      </div>
    </div>
  </div>

  <!-- EXPORT MODAL -->
  <div class="modal" id="exportModal">
    <div class="modal-box" id="exportBox">
      <div class="modal-title">Export</div>

      <div class="summary-box" style="margin-top:0;">
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;">
          <div style="font-weight:900;color:var(--gold);">Logo</div>
          <div class="actions-row" style="margin-top:0;">
            <button type="button" class="secondarybtn" onclick="removeLogo()">Remove Logo</button>
          </div>
        </div>
        <div class="hint">Tap the logo in the header to upload a PNG.</div>
      </div>

      <hr>

      <label class="hint">Payday (week starts on this day)</label>
      <select id="paydaySelect">
        <option value="0">Sunday</option><option value="1">Monday</option><option value="2">Tuesday</option>
        <option value="3">Wednesday</option><option value="4">Thursday</option><option value="5">Friday</option>
        <option value="6">Saturday</option>
      </select>

      <hr>

      <h4 style="margin:0;">Pay Period (Payday Week)</h4>
      <div class="row">
        <input type="date" id="ppStart" disabled>
        <input type="date" id="ppEnd" disabled>
      </div>
      <div class="actions-row">
        <button type="button" class="secondarybtn" onclick="prevPayPeriod()">◀ Prev</button>
        <button type="button" class="secondarybtn" onclick="nextPayPeriod()">Next ▶</button>
        <button type="button" onclick="exportPayPeriodCSV()">Export This Pay Period</button>
      </div>

      <hr>

      <h4 style="margin:0;">CSV Date Range</h4>
      <div class="row">
        <input type="date" id="exportStart">
        <input type="date" id="exportEnd">
      </div>

      <div class="actions-row">
        <button type="button" onclick="exportCSV()">Download CSV</button>
        <button type="button" class="secondarybtn" onclick="closeExport()">Close</button>
      </div>

      <div class="summary-box">
        <h4 style="margin:0 0 8px 0;">Export Summary</h4>
        <div class="actions-row">
          <button type="button" onclick="buildSummary('range')">Summary for Date Range</button>
          <button type="button" class="secondarybtn" onclick="buildSummary('payperiod')">Summary for Pay Period</button>
        </div>
        <div id="summaryOut" style="margin-top:10px; opacity:.95;"></div>
      </div>
    </div>
  </div>

  <div id="toasts"></div>

  <script src="app.js"></script>
</body>
</html>